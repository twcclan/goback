steps:
  - name: 'gcr.io/$PROJECT_ID/cancelot'
    args: [
      '--current_build_id', '$BUILD_ID',
      '--branch_name', '$BRANCH_NAME'
    ]
  - name: 'gcr.io/cloud-builders/docker'
    entrypoint: 'bash'
    args: ['-c', 'docker pull eu.gcr.io/$PROJECT_ID/goback-builder || true']
  - name: 'gcr.io/cloud-builders/docker'
    args: ['build', '-t', 'eu.gcr.io/$PROJECT_ID/goback-builder', '--cache-from', 'eu.gcr.io/$PROJECT_ID/goback-builder', '--target', 'builder', '.']
  - name: 'gcr.io/cloud-builders/docker'
    args: ['build', '--cache-from', 'eu.gcr.io/$PROJECT_ID/goback-builder', '.']
secrets:
images: ['eu.gcr.io/$PROJECT_ID/goback-builder']
timeout: 1200s